<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="renderer" content="webkit">
  <title>æˆ‘å¬ï¼Œæˆ‘äº«å¬</title>
  <meta name="keywords" content="æˆ‘å¬ï¼Œæˆ‘äº«å¬,ä¸»æ’­,ä¸»æ’­å¹³å°,ä¸“ä¸šä¸»æ’­å¹³å°">
  <meta name="description" content="æˆ‘å¬ï¼Œæˆ‘äº«å¬">
  <!--[if lt IE 8]>
    <script>
      alert('æœ¬ç³»ç»Ÿå·²ä¸æ”¯æŒIE6-8ï¼Œè¯·ä½¿ç”¨è°·æ­Œã€ç«ç‹ç­‰æµè§ˆå™¨\næˆ?60ã€QQç­‰å›½äº§æµè§ˆå™¨çš„æé€Ÿæ¨¡å¼æµè§ˆæœ¬é¡µé¢ï¼?);
    </script>
  <![endif]-->
  <link rel="shortcut icon" href="./resources/images/favicon.ico" />
  <link rel="stylesheet" href="./resources/plugins/hplus/css/bootstrap.min.css">
  <link href="./resources/plugins/hplus/css/font-awesome.min.css" rel="stylesheet">
  <link href="./resources/plugins/hplus/js/plugins/layer/skin/layer.css" rel="stylesheet" id="layui_layer_skinlayercss">
  <link href="./resources/plugins/hplus/js/plugins/layer/skin/layer.ext.css" rel="stylesheet" id="layui_layer_skinlayerextcss">
  <link href="./resources/plugins/hplus/js/plugins/layer/skin/moon/style.css" rel="stylesheet" id="layui_layer_skinmoonstylecss">
  <link href="./resources/plugins/hplus/css/style.min.css" rel="stylesheet">
  <link href="./resources/css/host.css" rel="stylesheet">
  <script src="./resources/plugins/hplus/js/jquery-2.1.1.min.js"></script>
  <script src="./resources/js/mainPage.js"></script>
  <script src="./resources/js/context.utils.js"></script>
  <script src="./resources/js/host.js"></script>
</head>
<body style="background:#f2f2f2;overflow:auto;">
  <!-- é¡µå¤´ -->
  <div style="width:100%;height:52px;background:#fff;border-bottom:2px solid #ccc;">
    <div class="" style="float:left;width:15%;line-height:50px;">
      <img alt="woting logo" style="width:80%;height:32px;padding-left:30px;" src="http://wotingfm.com:908/CM/resources/images/logo_yellow.png" />
    </div>
  </div>
  <!-- é¡µä¸»ä½?-->
  <div id="wrapper">
    <!--å·¦ä¾§å¯¼èˆª-->
    <div class="navLeft">
      <!-- ä¸ªäººä¿¡æ¯ -->
      <div class="person">
        <div class="perImg">
          <img src="http://wotingfm.com:908/CM/resources/images/a5.jpg" alt=""/>
          <p>èƒ–èƒ–</p>
        </div>
        <div class="perRelation">
          <div class="fs"><span><a href="#">1.3ä¸?/a></span>ç²‰ä¸</div>
          <div class="gz"><span><a href="#">668</a></span>å…³æ³¨</div>
        </div>
      </div>
      <!-- å¯¼èˆªåˆ—è¡¨ -->
      <nav class="nav">
        <ul>
          <li class="navList active"><a _href="./host/zj.html" href="javascript:void(0);">ä¸“è¾‘ç®¡ç†</a></li>  
          <li class="navList"><a _href="./host/audio.html" href="javascript:void(0);">å£°éŸ³ç®¡ç†</a></li>
          <span class="bar"></span>                
        </ul>
      </nav>
    </div>
    <!--ä¸­é—´éƒ¨åˆ†å¼€å§?->
    <div class="" id="content-main">
      <!--ç™»å½•è¿›æ¥ï¼Œé»˜è®¤æ˜¾ç¤ºHostæ¬¢è¿é¦–é¡µ-->
      <iframe width="100%" height="100%" src="./host/zj.html" frameborder="0" name="myIframe" id="myIframe"></iframe>
      <iframe width="100%" height="680px" src="./host/audio.html" scrolling="no" frameborder="0" name="newIframe" id="newIframe"></iframe>
    </div>
    <!-- å³ä¾§çƒ­ç‚¹åŒ?-->
    <div class="sources">
      <div class="hots">æ–°é—»çƒ­ç‚¹</div>
      <div class="dataAnalysis">æ•°æ®åˆ†æ</div>
    </div>
  </div>
  <!-- å…¨å±€js -->
  <script src="./resources/plugins/hplus/js/bootstrap.min.js"></script>
  <script src="./resources/plugins/hplus/js/plugins/metisMenu/jquery.metisMenu.js"></script>
  <script src="./resources/plugins/hplus/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
  <script src="./resources/plugins/hplus/js/layer.min.js"></script>
  <!-- è‡ªå®šä¹‰js -->
  <script src="./resources/plugins/hplus/js/hplus.min.js"></script>
  <!-- jQuery Validation plugin javascript-->
  <script src="./resources/plugins/hplus/js/plugins/validate/jquery.validate.min.js"></script>
  <!-- ç¬¬ä¸‰æ–¹æ’ä»?-->
  <script src="./resources/plugins/hplus/js/plugins/pace/pace.min.js"></script>
  <script>
  $.validator.setDefaults({
    highlight:function(a){$(a).closest(".form-group").addClass("has-error")},
    success:function(a){$(a).closest(".form-group").removeClass("has-error")},
    errorElement:"span",
    errorPlacement:function(a,b){if(b.is(":radio")||b.is(":checkbox")){a.appendTo(b.parent().parent().parent())}else{a.appendTo(b.parent())}},
    errorClass:"help-block m-b-none",
    validClass:"help-block m-b-none"
  });
  $(function(){
    /*æ¸…é™¤æµè§ˆå™¨ç¼“å­?/
    $.ajaxSetup ({
      cache: false 
    });
    var dataParam={};
    var iframe;
    //ç‚¹å‡»åŠŸèƒ½åˆ—è¡¨ï¼Œåˆ‡æ¢é¡µé?
    $(".navList").on("click",function(){
      $("#myIframe").attr({"src":$(this).children("a").attr("_href")});
      $(this).addClass("active").siblings().removeClass("active");
      $(".bar").css({"top":$(this).index()*$(this).height()});
    });

    /*
              ä»¥ä¸‹æ˜¯åˆ›å»ºä¸“è¾‘èŠ‚ç›®ç›¸å…³å†…å®?
    */
    //åˆå§‹åŒ–åˆ›å»ºä¸“è¾‘å…ƒç´ çš„ä½ç½®
    $(".opeBox,#newIframe").css({"left":($(window).width()-$(".opeBox").width())/2});
    //ç‚¹å‡»é®ç½©ï¼Œæˆ–å–æ¶ˆï¼Œç¡®å®šï¼Œå…³é—­è¿™äº›æŒ‰é’®æ—¶ï¼Œéšè—çª—å£å’Œé®ç½?å¹¶é‡ç½®è¡¨å?
    $(".shade,.close-link").on("click",function(){
      $("form")[0].reset();
      $(".opeBox").attr({"opeType":"conAdd"}).find("h5").text("åˆ›å»ºä¸“è¾‘");
      $("input").remove("#ContentId");
      $("<div class='previewImg'><img class='defaultImg' src='http://wotingfm.com:908/CM/resources/images/default.png' alt='front cover' /></div>").replaceAll(".previewImg");
      $(".shade,.opeBox,#newIframe").css({"display":"none"});
    });
      
    //å°é¢å›¾ç‰‡é¢„è§ˆä¸ä¸Šä¼?
    $("input[type='file']").change(function(){
      var _this=$(this);
      //å›¾ç‰‡é¢„è§ˆ
      if($(".defaultImg").css("display")!="none"){
        $(".defaultImg").css({"display":"none"});
      }
      var fileReader = new FileReader();
      fileReader.onload = function(evt){
        if(FileReader.DONE==fileReader.readyState){
          var newImg = $("<img alt='front cover' class='newImg' />");
          newImg.attr({"src":this.result});//æ˜¯Base64çš„data urlæ•°æ®
          if($(".previewImg").children().length>=1){
            $(".previewImg img:last").replaceWith(newImg);
          }else{
            $(".previewImg").append(newImg);
          }
        }
      }
      fileReader.readAsDataURL($(this)[0].files[0]);
         
      //æ–‡ä»¶ä¸Šä¼ 
      var oMyForm = new FormData();
      oMyForm.append("ContentFile", $(this)[0].files[0]);
      $.ajax({
        url:rootPath+"common/uploadCM.do",
        type:"POST",
        data:oMyForm,
        cache: false,
        processData: false,
        contentType: false,
        dataType:"json",
        //è¡¨å•æäº¤å‰è¿›è¡ŒéªŒè¯?
        success: function (opeResult) {
          if(opeResult.ful[0].storeFilename){
            _this.siblings("input[type='hidden']").val(opeResult.ful[0].storeFilename);
          }else{
            alert(opeResult.err)
          }
        },
        error: function(jqXHR){
          alert("å‘ç”Ÿé”™è¯¯" + jqXHR.status);
        }
      });
    });
    
    //ä¸“è¾‘åˆ†ç±»
    $("#ContentCatalogsId").on("change",function(){
      $(".changeLabel").css({"display":"none"});
      $(".ul-metas").empty();
      var categoryId=$(this).children('option:selected').val();
      $(".changeLabel").css({"display":"block"});
      $.ajax({
        type: "POST",    
        url:rootPath+"common/getCategoryTags.do",
        dataType: "json",
        data:{CategoryId:categoryId},
        success: function(categoryTags) {
          if (categoryTags.ReturnType=="1001") {
            for(var i=0;i<categoryTags.AllCount;i++){
              li_tags=$("<li><input  type='checkbox' Title="+categoryTags.ResultList[i].Title+" Mid="+categoryTags.ResultList[i].Mid+" Id="+categoryTags.ResultList[i].Id+" value="+categoryTags.ResultList[i].Id+"><span class='ic-checkbox'></span>"+categoryTags.ResultList[i].Title+"</li>");
              $(".ul-metas").append(li_tags);
            }
            //ä¸“è¾‘åˆ†ç±»æ ‡ç­¾æœ€å¤šå¯é€‰ä¸ªæ•?
            $(".ul-metas li input[type='checkbox']").on("click",function(){
              $("input[type='checkbox']").attr('disabled', true);
              if($("input[type='checkbox']:checked").length>=3){
                $("input[type='checkbox']:checked").attr('disabled', false);
              }else{
                $("input[type='checkbox']").attr('disabled', false);
              }
            })
          }
        },
        error: function(jqXHR){
          alert("å‘ç”Ÿé”™è¯¯" + jqXHR.status);
        }
      });
    })
        
    //formè¡¨å•æäº¤
    $("#submitBtn,#draftBtn").click(function (){
      var values="";
      var i=0;
      var checked=$("input[type='checkbox']:checked");
      for(var i=0;i<checked.length;i++){
        if(i<checked.length-1){
          values+=checked[i].value+',';
        }else{
          values+=checked[i].value;
        }
      }  
      $("#ContentTags").val(values);
      var contentStatus=$(this).attr("id")=="submitBtn"?"1":"0";
      $("#ContentStatus").val(contentStatus);
      var opeType=$(".opeBox").attr("opeType");
      if(opeType=="conAdd"){
        if($("#ContentImg").val()==""){
          //å¦‚æœªè®¾ç½®å°é¢ï¼Œå°†ä½¿ç”¨å¹³å°é»˜è®¤å›¾ç‰‡
          $("#ContentImg").val($(".defaultImg").attr("src"));
        }
        dataParam={
          "url":rootPath+"content/seq/addSeqMediaInfo.do",
          "data":$("#addSequForm").serializeArray()
        };
        $(".changeLabel").css({"display":"none"});
        submitForm(dataParam);
        $(".changeLabel").css({"display":"none"});
        $(".ul-metas").empty();
      }else{
        dataParam={
          "url":rootPath+"content/seq/updateSeqMediaInfo.do",
          "data":$("#addSequForm").serializeArray(),
          "contentId":$("#ContentId").val()
        };
        $(".changeLabel").css({"display":"none"});
        submitForm(dataParam);
        $(".changeLabel").css({"display":"none"});
        $(".ul-metas").empty();
      }
    });
         
    /*
    beforeSend : function() {
      //åˆ¶å®šè¡¨å•éªŒè¯è§„åˆ™ä¸æç¤?
      $("#addSequForm").validate({
        rules:{
          ContentName:{required:true},
        },
        messages:{
          ContentName:{required:"<i class='fa fa-times-circle'></i> "+"è¯·è¾“å…¥ä¸“è¾‘åç§?}
        }
      });
      if($(".form-group").hasClass("has-error")){//è¿™åˆ¤æ–­æœ‰é—®é¢˜ï¼Œæ‰¾æ—¶é—´ç ”ç©¶ä¸€ä¸?ç¬¬ä¸€æ¬¡æ€»æ˜¯falseï¼Œç¬¬äºŒæ¬¡æ‰ç”Ÿæ•ˆï¼ŒéªŒè¯æ‰§è¡Œçš„å…ˆåé—®é¢?
        return false;
      }
    },
    */
    function submitForm(obj){
      $.ajax({
        url:obj.url,
        type:"POST",
        dataType:"json",
        data:obj.data,
        success: function (opeResult) {
          if (opeResult.ReturnType=="1001") {
            if(obj.contentId){
              alert("ä¸“è¾‘ä¿®æ”¹æˆåŠŸ");
              $(".opeBox").attr({"opeType":"conAdd"}).find("h5").text("åˆ›å»ºä¸“è¾‘");
              $("input").remove("#ContentId");
              $("<div class='previewImg'><img class='defaultImg' src='http://wotingfm.com:908/CM/resources/images/default.png' alt='front cover' /></div>").replaceAll(".previewImg");
            }else{
              alert("ä¸“è¾‘åˆ›å»ºæˆåŠŸ");
            }
            $("#addSequForm")[0].reset();
            $(".shade,.opeBox").css({"display":"none"});
            //æ·»åŠ æˆåŠŸåï¼Œé‡æ–°åŠ è½½åˆ—è¡¨
            AfterAddList({"UserId":userId,"url":rootPath+"content/seq/getHostSeqMediaList.do"});
          }else{
            alert(opeResult.Message);
          }
        },
        error: function(jqXHR){
          alert("å‘ç”Ÿé”™è¯¯" + jqXHR.status);
        }
      });
    }
            
    function AfterAddList(obj) {
      iframe=$(document.getElementById('myIframe').contentWindow.document);
      $.ajax({
        type : "POST",
        url : obj.url,
        dataType : "json",
        data : JSON.stringify(obj),
        beforeSend : function() {
          iframe.find(".actList").html("<div style='text-align:center;height:300px;line-height:200px;'>æ•°æ®åŠ è½½ä¸?..</div>");
        },
        success : function(resultData) {
          if (resultData.ReturnType == "1001") {
            iframe.find(".actList").html(""); //å†é‡æ–°åˆ›å»ºæ–°çš„æ•°æ®é›†æ—¶ï¼Œå…ˆæ¸…ç©ºä¹‹å‰çš„
            iframe.find(".totalCount").text(resultData.ResultList.AllCount);
            ContentListLoad2(resultData);
          } else {
            iframe.find(".actList").html("<div style='text-align:center;height:300px;padding:20px;padding-top:140px;'>"+ resultData.Message)+ ")";
          }
        },
        error : function(jqXHR) {
          iframe.find(".actList").html("<div style='text-align:center;height:300px;line-height:200px;'>è·å–æ•°æ®å‘ç”Ÿé”™è¯¯ï¼?+ jqXHR.status+ "</div>");
        }
      });
    }
            
    //åˆ›å»ºèŠ‚ç›®åˆ—è¡¨DOMæ ?
    function ContentListLoad2(actList) {
      iframe=$(document.getElementById('myIframe').contentWindow.document);
      var actListLength = actList.ResultList.AllCount;
      var mediaType=actList.ResultList.List[0].MediaType;
      if (actListLength == 0) {
        iframe.find(".actList").html("<div style='text-align:center;height:500px;line-height:300px;'>è¿˜æ²¡æœ‰åˆ›å»ºèŠ‚ç›®å“¦ï¼?/div>");
      } else {
        //å£°æ˜ä¸‹é¢éœ€è¦åˆ›å»ºçš„èŠ‚ç‚¹ï¼Œä»¥ä¾¿æ·»åŠ å†…å®¹å’Œæ·»åŠ åˆ°æ–‡æ¡£ä¸­
        var actListDiv,listDiv,imgDiv,imgA,thumbImg,imgShade,conUpdate,conEye,conDel,conPub,infoDiv,infoH,infHA,infoP1,infoP2;
        //å¾ªç¯åŠ è½½åˆ—è¡¨
        for (var i = 0; i < actListLength; i++) {
          listDiv = $("<div class='listBox'></div>");
          listDiv.attr({
            "contentId": actList.ResultList.List[i].ContentId,
            "contentName": actList.ResultList.List[i].ContentName,
            "contentDesc": actList.ResultList.List[i].ContentDesc,
            "contentImg": actList.ResultList.List[i].ContentImg,
            "subjectWords": actList.ResultList.List[i].SubjectWords
          });
          imgDiv = $("<div></div>");
          imgA=$("<a href='javascript:;'></a>");
          thumbImg = $("<img alt='èŠ‚ç›®å°é¢å›¾ç‰‡'>");
          thumbImg.attr({'src' : actList.ResultList.List[i].ContentImg});
          imgShade=$("<div class='imgShade'></div>");
          conUpdate=$("<i class='fa fa-pencil' opeType='conUpdate'></i>");
          conEye=$("<i class='fa fa-eye' opeType='conEye'></i>");
          conDel=$("<i class='fa fa-trash-o' opeType='conDel'></i>");
          conPub=$("<i class='fa fa-plus-square-o' opeType='conPub'></i>");
          infoDiv = $("<div class='infoBox'>");
          infoH = $("<h4></h4>");
          infoHA=$("<a href='javascript:;'></a>");
          imgShade.append(conUpdate).append(conEye).append(conDel).append(conPub);
          infoHA.text(actList.ResultList.List[i].ContentName);
          infoP2 = $("<p class='lastTime'></p>");
          infoP2.text((actList.ResultList.List[i].CTime).slice(0,10));
          if(mediaType=="SEQU"){
            listDiv.attr({
    	        "contentCatalogsId": actList.ResultList.List[i].ContentCatalogs[0].CataDid
    	        //contentChannelId æœ‰çš„ä¸“è¾‘æ²¡æœ‰é€‰æ‹©æ ç›®åˆ†ç±»ï¼Œåé¢æ ¹æ®éœ€è¦å†æ”¹åŠ¨
    	        // "contentChannelId": actList.ResultList.List[i].ContentPubChannels[0].ChannelId
    	      });
            imgDiv.addClass("imgBox");
            infoP1 = $("<p class='subCount'></p>");
            infoP1.text(actList.ResultList.List[i].SubCount+"ä¸ªå£°éŸ?);
            infoDiv.append(infoH.append(infoHA)).append(infoP1).append(infoP2);
          }else{
            listDiv.attr({"contentSeqId": actList.ResultList.List[i].ContentSeqId});
            imgDiv.addClass("subImg");
            infoDiv.append(infoH.append(infoHA)).append(infoP2);
          }
            imgDiv.append(imgA.append(thumbImg)).append(imgShade);
            listDiv.append(imgDiv).append(infoDiv);
            iframe.find(".actList").append(listDiv);
        }
      }
    }
    
    //è·å–åˆ†ç±»åˆ—è¡¨
    getCatalogs();
    //è·å¾—æ ç›®åˆ—è¡¨
    getChannel();
  });
  </script>
  <!-- é®ç½© -->
  <div class="shade"></div>
  <!--åˆ›å»ºä¸“è¾‘ç•Œé¢-->
  <div class="row opeBox" id="sequ" opeType="conAdd">
    <div class="col-sm-12">
      <div class="ibox float-e-margins">
        <div class="ibox-title">
          <h5>åˆ›å»ºä¸“è¾‘</h5>
          <div class="ibox-tools">
            <a class="close-link">
              <i class="fa fa-times"></i>
            </a>
          </div>
        </div>
        <div class="ibox-content">
          <form class="form-horizontal m-t" id="addSequForm" onsubmit="return false;">
            <input id="UserId" name="UserId" class="form-control" type="hidden" value="123" />
            <input id="ContentStatus" name="ContentStatus" class="form-control" type="hidden" value="" />
            <div class="form-group">
              <label class="col-sm-3 control-label">ä¸“è¾‘åç§°ï¼?/label>
              <div class="col-sm-8">
                <input id="ContentName" name="ContentName" class="form-control" type="text" aria-required="true">
              </div>
            </div>
            <div class="form-group">
              <label class="col-sm-3 control-label">ä¸“è¾‘å°é¢ï¼?/label>
              <div class="col-sm-8">
                <div class="previewImg">
                  <img class="defaultImg" src="resources/images/default.png" alt="front cover" />
                </div>
                <input id="uploadImg" name="uploadImg" class="form-control" type="file" accept=".png,.jpg" />
                <input id="ContentImg" name="ContentImg" type="hidden" value="" />
                <span class="help-block m-b-none"><i class="fa fa-info-circle"></i>æ–‡ä»¶æœ€å¤?Mï¼Œæ”¯æŒJPGã€PNGæ ¼å¼</span>
              </div>
            </div>
            <div class="form-group">
              <label class="col-sm-3 control-label">ä¸“è¾‘åˆ†ç±»ï¼?/label>
              <div class="col-sm-8">
                <select class="form-control" name="ContentCatalogsId" id="ContentCatalogsId">
                  <option value="">è¯·é€‰æ‹©</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <div class="changeLabel">
                <label class="col-sm-5 control-label change-label">é€‰æ‹©æ ‡ç­¾(æœ€å¤šå¯é€?ä¸?</label>
                <input type="hidden" name="ContentTags" id="ContentTags" value="0">
                <div class="metas clearfix new_tags" style="">
                  <ul class="ul-metas" id="ul-metas"></ul>
                </div>
              </div>
            </div>
            <div class="form-group">
            <label class="col-sm-3 control-label">å‘å¸ƒæ ç›®ï¼?/label>
              <div class="col-sm-8">
                <select class="form-control" name="ContentChannelId" id="ContentChannelId" value="" >
                  <option value="">è¯·é€‰æ‹©</option>
                </select>
              </div>
            </div>
            <div class="form-group">
            <label class="col-sm-3 control-label">ä¸“è¾‘ç®€ä»‹ï¼š</label>
            <div class="col-sm-8">
              <textarea id="ContentDesc" name="ContentDesc" class="form-control"></textarea>
            </div>
            </div>
            <!-- 
            <div class="form-group">
              <label class="col-sm-3 control-label">æ·»åŠ å£°éŸ³ï¼?/label>
              <div class="col-sm-8">
                <input id="contentUrl" name="contentUrl" class="form-control" type="file">
              </div>
            </div>
             -->
            <div class="form-group">
              <div class="col-sm-3 text-right">
                <button class="btn btn-warning" id="submitBtn" type="submit">æäº¤</button>
              </div>
              <div class="col-sm-3 text-center">
                <button class="btn btn-warning" id="pubBtn" type="publish">å‘å¸ƒ</button>
              </div>
              <div class="col-sm-3 text-center">
                <button class="btn btn-warning" id="draftBtn" type="draftBtn">å­˜è‰ç¨?/button>
              </div>
              <div class="col-sm-3 text-left">
                <button class="close-link btn btn-warning">å–æ¶ˆ</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</body>
</html>