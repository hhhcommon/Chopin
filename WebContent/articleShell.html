<!DOCTYPE html>
<!-- 内容页的壳子，为web使用 -->
<html>
<head>
<meta charset="UTF-8">

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="cache-control" content="no-cache"/>
<meta http-equiv="pragma" content="no-cache"/>
<meta http-equiv="expires" content="0"/>
<!--[if lt IE 8]>
<script>
  alert('本系统已不支持IE6-8，请使用谷歌、火狐等浏览器\n或360、QQ等国产浏览器的极速模式浏览本页面！');
</script>
<![endif]-->

<script src="./resources/plugins/hplus/js/jquery-2.1.1.min.js"></script>
<script src="./resources/js/common.utils.js"></script>
<script src="./resources/js/context.utils.js"></script>
<script src="./resources/js/framework.utils.js"></script>
<script src="./resources/plugins/spiritui/jq.spirit.utils.js"></script>
<script src="./resources/plugins/spiritui/jq.spirit.pageFrame.js"></script>

<script src="./resources/chopin/Light-AudioPlayer/js/patch.js"></script>
<script src="./resources/chopin/Light-AudioPlayer/js/audioplayer.js"></script>

<link rel="stylesheet" type="text/css" href="./resources/chopin/Light-AudioPlayer/css/reset.css" />
<link rel="stylesheet" type="text/css" href="./resources/chopin/Light-AudioPlayer/css/style.css" />
<link rel="stylesheet" type="text/css" href="./resources/chopin/Light-AudioPlayer/css/audioplayer.css" />

<!--

-->
<link rel="stylesheet" type="text/css" href="./resources/css/common.css"/>
<link rel="stylesheet" type="text/css" href="./resources/css/mainPage.css"/>
<link rel="stylesheet" type="text/css" href="./resources/plugins/spiritui/themes/default/all.css"/>

<title></title>
<style>
html { color:#000; background:#fff; }
body { padding:0; width:100% }

#a_content {
  padding: 30px 20px 30px 20px;
}
#a_content div {
  width:100%;
}
#a_title {
  height:23px;
  text-align:center;
  align:center;
  line-height:34px;
  font-size:23px;
  font-family:"黑体";
  font-weight:bold;
  display:inline-block; 
}
#a_time {
  padding-top:4px;
  height:24px;
  text-align:center;
  align:center;
  line-height:24px;
  font-size:14px;
}
#a_time span {
  height:20px;
  text-align:bottom;
  align:center;
  line-height:20px;
  font-size:16px;
}
#_source {
  position:absolute;
  right:30px;
  font-size:12px;
}
#_img {
  positiion:absolute;
}
#a_media {
  height:30px;
}
#a_html {
  height:30px;
}
#a_nullhtml {
  display:none;
}
</style>
</head>
<body>
<div id="a_content" style="display:none;">
  <div id="a_title"></div>
  <div id="a_time"><span id="_time"></span><span id="_source" style="font-size:12px;margin-top:5px;"><a target="_blank" href="http://www.baidu.com">来源：肖邦网</a></span></div>
  <div id="a_img"><img id="_img"></img></div>
  <div id="a_media" style="border:1px solid black">
    <!-- 音频播放 -->
    <div id="audio_bar" style="display:none;">
      <audio loop="loop" >
        <source src="./resources/chopin/Light-AudioPlayer/audio/seeyouagain.mp3"" type="audio/mpeg" />
      </audio>
    </div>
  </div>
  <div id="a_html"><iframe frameborder="no" style="display:none;width:100%;" id="mainContent" scrolling="no"></iframe></div>
  <div id="a_nullhtml"></div>
</div>
</body>

<script>
var contentId=getUrlParam(window.location.href, "ContentId");
var rootPath=getRootPath();
var contentData=null;
var voiceExtName="mp3;m4a;m3u8";

//主函数
$(function() {
  if (rootPath.length==1) rootPath="http://localhost:1108/Chopin";
  var _data={};
  _data.ContentId=contentId;
  $.ajax({type:"post", async:true, url:rootPath+"/content/getContentInfo.do", dataType:"json", data:_data,
    success: function(jsonData) {
      if (jsonData.ReturnType=='1001') {
        contentData=jsonData.ResultInfo;
        showArticle(contentData);
      } else {
        showErr(jsonData.message);
      }
    },
    error: function(jqXHR) {
      showErr(jqXHR.status);
    }
  });
});

function showArticle(artData) {
  $("#a_title").html(artData.ContentName);
  $("#_time").html((new Date(artData.ContentPubTime)).format("yyyy-M-d"));
  if (artData.ContentSource&&artData.ContentSource.length>0) $("#_source").html(artData.ContentSource);
  else $("#_source").hide();
  if (artData.ContentImg&&artData.ContentImg.length>0) showImg("a_img", artData.ContentImg);
  else $("#a_img").hide();
  $("#a_content").show();
  //处理视音频
  if (artData.ContentSubjectWord&&artData.ContentSubjectWord.length>0) playMedia("a_media", artData.ContentSubjectWord);
  else $("#a_media").hide();
  //处理iframe内容
  if (artData.ContentPlay&&artData.ContentPlay.length>0) {
    showHtml("a_html", artData.ContentPlay);
  } else showNullHtml();
}
function showImg(docEleId, imgSrc) {
  //判断文件是否存在
  var img=new Image();
  img.onload=function() {
    var parentWidth=$("#a_img").width();
    var minWidth=500;
    if (parentWidth>minWidth+10) {
      h=(minWidth+10)*0.6;
      $("#a_img").height(h);
      $("#_img").width(minWidth);
      $("#_img").height(h-10);
      $("#_img").css({"margin-top":"5px"});
      $("#_img").css({"margin-left":function(){return ((parentWidth-minWidth)/2);}});
      $("#_img").attr("src",imgSrc);
    } else {
      var h=parentWidth*0.6;
      $("#a_img").height(h);
      $("#_img").width(parentWidth-10);
      $("#_img").height($("#a_img").height()-10);
      $("#_img").css({"margin-top":"5px", "margin-left":"5px"});
      $("#_img").attr("src",imgSrc);
    }
  };
  img.onerror=function() {
    $("#a_img").hide();
  };
  img.src=imgSrc;
}
function playMedia(docEleId, mediaUrl) {
  //判断是视频还是音频
  var flag=isTypeUrl(mediaUrl, voiceExtName)?1:2; //=2-视频；=1-音频
  if (flag==1) { //音频
    alert("DDD");
    $("#audio_bar").show();
  } else { //视频
  }
}
function showHtml(docEleId, htmlSrc) {
        return;
  //判断文件是否存在
  $.ajax({ype: "GET", cache: false, url: htmlSrc, data:null,
    success:function() {
      $("#a_content").show();
      $("#mainContent").attr("src", htmlSrc);
      $("#mainContent").css("display", "block");
      var iframe=document.getElementById("mainContent");
      var i=0;
      var timer1=setInterval(function() {
        var subWeb=iframe.contentWindow.document.body;
        if (subWeb) $("#mainContent").attr("height", subWeb.scrollHeight);
      },200);
      if (iframe.attachEvent){
        iframe.attachEvent("onload", function(){
          var subWeb=iframe.contentWindow.document.body;
          if (subWeb) $("#mainContent").attr("height", subWeb.scrollHeight);
          window.clearInterval(timer1);
        });
      } else {
        iframe.onload=function(){
          var subWeb=iframe.contentWindow.document.body;
          if (subWeb) $("#mainContent").attr("height", subWeb.scrollHeight);
          window.clearInterval(timer1);
        };
      }
      setTimeout(function() {window.clearInterval(timer1);}, 3000);
    },
    error:function() {
      showNullHtml();
    }
  });
}
function showNullHtml() {
  if ((contentData.ContentImg&&contentData.ContentImg.length>1)
    || (contentData.ContentSubjectWord&&contentData.ContentSubjectWord.length>1)) {
    $("#a_html").hide();
    $("#a_nullhtml").show();
    if (contentData.ContentPub&&contentData.ContentPub.length>1) {
      $("#a_nullhtml").html("感谢本内容的提供者："+contentData.ContentPub);
    }
    if (contentData.CTime&&contentData.CTime>1) {
      $("#a_nullhtml").html($("#a_nullhtml").html()+"</br>提供时间："+(new Date(contentData.CTime)).format("yyyy-MM-dd hh:mm:ss.S"));
    }
  } else showErr();
}
function showErr(msg) {
  $("html").css("background-color", "#A8A8A8");
  $("#a_content").html("");
  $("#a_content").css("align", "center");
  var parentWidth=$("body").width();
  var minWidth=607;
  var nullImg=$("<img></img>");
  $("#a_content").append(nullImg);
  if (parentWidth>607) {
    $(nullImg).css({"width":607, "height":411});
    $(nullImg).css({"margin-top":"5px"});
    $(nullImg).css({"margin-left":function(){return ((parentWidth-minWidth)/2);}});
  } else {
    $(nullImg).css({"width":(parentWidth-20)});
    $(nullImg).css({"height":function(){return (parentWidth-20)*(411/608);}});
  }
  $(nullImg).attr("src","./resources/chopin/imgs/nullPage.png");
  $("#a_content").show();
}
function isTypeUrl(urlStr, typeStr) {
  var words=typeStr.split(';');
  var pos1=urlStr.lastIndexOf("\/");
  var pos2=urlStr.lastIndexOf("\\");
  var pos=(pos1>pos2?pos1:pos2);
  var _fn=urlStr;
  if (pos!=-1) urlStr=urlStr.substr(pos+1);
  for (var i=0; i<words.length; i++) {
    if (_fn.indexOf("."+words[i]+"?")>0) return true;
    if (_fn.length==(_fn.indexOf("."+words[i])+words[i].length)+1) return true;
  }
  return false;
}
</script>
</html>